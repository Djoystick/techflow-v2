<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechFlow Mini App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #0088cc; --primary-dark: #0066aa;
            --bg: #ffffff; --bg-secondary: #f5f5f5;
            --text: #000000; --text-secondary: #666666; --border: #e0e0e0;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; transition: all 0.3s; }
        body.dark-mode {
            --bg: #1a1a1a; --bg-secondary: #2a2a2a;
            --text: #ffffff; --text-secondary: #cccccc; --border: #444444;
        }
        header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 16px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .header-container { max-width: 1200px; margin: 0 auto; padding: 0 16px; display: flex; justify-content: space-between; align-items: center; gap: 12px; }
        .logo { font-size: 20px; font-weight: 700; color: white; }
        .header-buttons { display: flex; gap: 8px; }
        .btn-header { background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; }
        .btn-header:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 600px; margin: 0 auto; padding: 16px; }
        .tabs { display: flex; gap: 8px; margin: 16px 0; border-bottom: 2px solid var(--border); overflow-x: auto; }
        .tab-btn { padding: 10px 16px; background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 13px; font-weight: 600; border-bottom: 3px solid transparent; transition: all 0.2s; white-space: nowrap; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .news-item { background: white; border-radius: 6px; padding: 12px; margin-bottom: 10px; border: 1px solid var(--border); cursor: pointer; transition: all 0.2s; }
        body.dark-mode .news-item { background: #2a2a2a; }
        .news-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .news-item-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
        .news-item-preview { font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; }
        .news-item-meta { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); }
        .news-item-category { display: inline-block; background: rgba(0,136,204,0.15); color: var(--primary); padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; }
        .reader-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 1000; overflow-y: auto; }
        .reader-overlay.active { display: flex; align-items: center; justify-content: center; }
        .reader { background: white; border-radius: 6px; max-width: 580px; width: 90%; max-height: 80vh; overflow-y: auto; animation: slideUp 0.3s ease-out; }
        body.dark-mode .reader { background: #2a2a2a; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .reader-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 14px; display: flex; justify-content: space-between; align-items: center; border-radius: 6px 6px 0 0; }
        .reader-header h2 { font-size: 16px; margin: 0; }
        .reader-close { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }
        .reader-body { padding: 18px; }
        .reader-image { width: 100%; border-radius: 4px; margin-bottom: 14px; max-height: 300px; object-fit: cover; }
        .reader-meta { display: flex; gap: 12px; font-size: 11px; color: var(--text-secondary); margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border); flex-wrap: wrap; }
        .reader-content { font-size: 14px; line-height: 1.6; color: var(--text); margin-bottom: 12px; }
        .reader-rating { display: flex; gap: 6px; align-items: center; padding-top: 12px; border-top: 1px solid var(--border); }
        .rating-stars { display: flex; gap: 2px; }
        .star { font-size: 16px; cursor: pointer; color: #ddd; transition: color 0.2s; }
        .star:hover, .star.active { color: #ffc107; }
        .admin-panel { background: white; border-radius: 6px; padding: 16px; margin-bottom: 16px; }
        body.dark-mode .admin-panel { background: #2a2a2a; }
        .admin-panel h3 { font-size: 15px; margin-bottom: 12px; color: var(--primary); font-weight: 600; }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; font-size: 12px; font-weight: 600; margin-bottom: 4px; color: var(--text); }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-family: inherit; font-size: 12px; background: white; color: var(--text); transition: all 0.2s; }
        body.dark-mode .form-group input, body.dark-mode .form-group textarea, body.dark-mode .form-group select { background: #3a3a3a; color: white; border-color: #444444; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.15); }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .admin-buttons { display: flex; gap: 8px; }
        .btn { flex: 1; padding: 8px; border: none; border-radius: 4px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: var(--border); color: var(--text); }
        .btn-secondary:hover { background: var(--text-secondary); color: white; }
        .news-actions { display: flex; gap: 6px; margin-top: 8px; }
        .news-actions button { flex: 1; padding: 6px; border: none; border-radius: 3px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .news-actions .edit-btn { background: rgba(0,136,204,0.2); color: var(--primary); }
        .news-actions .edit-btn:hover { background: var(--primary); color: white; }
        .news-actions .delete-btn { background: rgba(230,57,70,0.2); color: #e63946; }
        .news-actions .delete-btn:hover { background: #e63946; color: white; }
        .empty-state { text-align: center; padding: 30px 16px; color: var(--text-secondary); }
        .empty-state i { font-size: 40px; opacity: 0.5; margin-bottom: 10px; }
        .notification { position: fixed; bottom: 16px; right: 16px; background: #31a24c; color: white; padding: 10px 14px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 2000; animation: slideInRight 0.3s ease-out; font-size: 12px; }
        .notification.error { background: #e63946; }
        @keyframes slideInRight { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">üì± TechFlow</div>
            <div class="header-buttons">
                <button class="btn-header" id="theme-toggle">üåô</button>
                <button class="btn-header" id="admin-toggle">‚öôÔ∏è</button>
                <a href="index.html" class="btn-header">‚Üê –í–µ–±</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="all">üì∞ –í—Å–µ</button>
            <button class="tab-btn" data-tab="bookmarks">üìå –ó–∞–∫–ª–∞–¥–∫–∏</button>
            <button class="tab-btn" data-tab="history">üïí –ò—Å—Ç–æ—Ä–∏—è</button>
        </div>
        <div id="all" class="tab-content active"></div>
        <div id="bookmarks" class="tab-content"></div>
        <div id="history" class="tab-content"></div>
    </div>

    <div class="container" id="admin-section" style="display: none;">
        <div class="admin-panel">
            <h3>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h3>
            <div class="form-group">
                <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                <input type="text" id="news-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫">
            </div>
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                <select id="news-category"><option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option></select>
            </div>
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <input type="text" id="news-preview" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
            </div>
            <div class="form-group">
                <label>–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
                <textarea id="news-content" placeholder="–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏"></textarea>
            </div>
            <div class="form-group">
                <label>–ê–≤—Ç–æ—Ä</label>
                <input type="text" id="news-author" placeholder="–ò–º—è –∞–≤—Ç–æ—Ä–∞">
            </div>
            <div class="form-group">
                <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                <input type="text" id="news-image" placeholder="https://...">
            </div>
            <div class="admin-buttons">
                <button class="btn btn-primary" id="add-news-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="btn btn-secondary" id="cancel-btn" style="display: none;">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <div class="admin-panel">
            <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
            <div class="form-group">
                <label>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="new-category" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é" style="flex: 1;">
                    <button class="btn btn-primary" id="add-category-btn" style="flex: 0.3;">‚ûï</button>
                </div>
            </div>
            <div id="categories-list" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
        </div>
    </div>

    <div class="reader-overlay" id="reader-overlay">
        <div class="reader" id="reader">
            <div class="reader-header">
                <h2 id="reader-title">–ù–æ–≤–æ—Å—Ç—å</h2>
                <button class="reader-close" onclick="closeReader()">&times;</button>
            </div>
            <div class="reader-body">
                <img id="reader-image" src="" alt="" class="reader-image">
                <div class="reader-meta">
                    <span id="reader-category"></span>
                    <span id="reader-author"></span>
                    <span id="reader-date"></span>
                    <span id="reader-views"></span>
                </div>
                <div class="reader-content" id="reader-content"></div>
                <div class="reader-rating">
                    <span>–û—Ü–µ–Ω–∏—Ç–µ:</span>
                    <div class="rating-stars" id="rating-stars">
                        <span class="star" data-rating="1">‚òÖ</span>
                        <span class="star" data-rating="2">‚òÖ</span>
                        <span class="star" data-rating="3">‚òÖ</span>
                        <span class="star" data-rating="4">‚òÖ</span>
                        <span class="star" data-rating="5">‚òÖ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.0/crypto-js.min.js"></script>
    <script>
        let allNews = [];
        let categories = [];
        let history = [];
        let currentNewsIndex = -1;
        let editingId = null;

        const init = () => {
            loadNews();
            loadCategories();
            loadHistory();
            loadTheme();
            renderAll();
            attachHandlers();
            updateCategorySelect();
        };

        const loadNews = () => {
            const stored = localStorage.getItem('techflow_news');
            allNews = stored ? JSON.parse(stored) : [];
        };

        const loadCategories = () => {
            const stored = localStorage.getItem('techflow_categories');
            categories = stored ? JSON.parse(stored) : ['AI', '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞', '–°—Ç–∞—Ä—Ç–∞–ø—ã'];
        };

        const loadHistory = () => {
            const stored = localStorage.getItem('techflow_history');
            history = stored ? JSON.parse(stored) : [];
        };

        const saveNews = () => {
            localStorage.setItem('techflow_news', JSON.stringify(allNews));
        };

        const saveCategories = () => {
            localStorage.setItem('techflow_categories', JSON.stringify(categories));
        };

        const saveHistory = () => {
            localStorage.setItem('techflow_history', JSON.stringify(history));
        };

        const renderAll = () => {
            renderTab('all', allNews);
            renderBookmarks();
            renderHistory();
        };

        const renderTab = (tabName, newsArray) => {
            const container = document.getElementById(tabName);
            const bookmarks = JSON.parse(localStorage.getItem('techflow_bookmarks') || '[]');

            if (newsArray.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-newspaper"></i><p>–ù–æ–≤–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p></div>';
                return;
            }

            container.innerHTML = newsArray.map((news, idx) => {
                const isBookmarked = bookmarks.includes(news.id);
                const newsIdx = allNews.findIndex(n => n.id === news.id);
                return `<div class="news-item" onclick="openReader(${newsIdx})">
                    <div class="news-item-title">${news.title}</div>
                    <div class="news-item-preview">${news.preview || news.title}</div>
                    <div class="news-item-meta">
                        <span class="news-item-category">${news.category}</span>
                        <span>${formatDate(news.date)}</span>
                        <span>üëÅÔ∏è ${news.views || 0}</span>
                    </div>
                    <div class="news-actions" onclick="event.stopPropagation();">
                        <button class="edit-btn" onclick="editNews('${news.id}')">‚úèÔ∏è –†–µ–¥–∞–∫</button>
                        <button class="delete-btn" onclick="deleteNews('${news.id}')">üóëÔ∏è –£–¥–∞–ª</button>
                        <button style="flex: 1; background: rgba(255,193,7,0.2); color: #ffc107; border: none; border-radius: 3px; cursor: pointer;" onclick="toggleBookmark('${news.id}', event)">
                            ${isBookmarked ? '‚≠ê' : '‚òÜ'}
                        </button>
                    </div>
                </div>`;
            }).join('');
        };

        const renderBookmarks = () => {
            const bookmarks = JSON.parse(localStorage.getItem('techflow_bookmarks') || '[]');
            const bookmarkedNews = allNews.filter(n => bookmarks.includes(n.id));
            renderTab('bookmarks', bookmarkedNews);
        };

        const renderHistory = () => {
            const historyNews = history.slice().reverse().slice(0, 20);
            renderTab('history', historyNews);
        };

        const toggleBookmark = (id, e) => {
            e.stopPropagation();
            const bookmarks = JSON.parse(localStorage.getItem('techflow_bookmarks') || '[]');
            const idx = bookmarks.indexOf(id);
            if (idx > -1) {
                bookmarks.splice(idx, 1);
                showNotif('‚ùå –£–¥–∞–ª–µ–Ω–æ');
            } else {
                bookmarks.push(id);
                showNotif('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ');
            }
            localStorage.setItem('techflow_bookmarks', JSON.stringify(bookmarks));
            renderAll();
        };

        const openReader = (idx) => {
            const news = allNews[idx];
            currentNewsIndex = idx;

            news.views = (news.views || 0) + 1;
            saveNews();

            const historyItem = { ...news };
            const historyIdx = history.findIndex(n => n.id === news.id);
            if (historyIdx > -1) history.splice(historyIdx, 1);
            history.push(historyItem);
            saveHistory();

            document.getElementById('reader-title').textContent = news.title;
            document.getElementById('reader-image').src = news.image || 'https://via.placeholder.com/500x300';
            document.getElementById('reader-category').textContent = news.category;
            document.getElementById('reader-author').textContent = news.author || '–ê–≤—Ç–æ—Ä';
            document.getElementById('reader-date').textContent = formatDate(news.date);
            document.getElementById('reader-views').textContent = `üëÅÔ∏è ${news.views}`;
            document.getElementById('reader-content').textContent = news.content || news.preview;

            loadRating(news);

            document.getElementById('reader-overlay').classList.add('active');
            document.body.style.overflow = 'hidden';
        };

        const closeReader = () => {
            document.getElementById('reader-overlay').classList.remove('active');
            document.body.style.overflow = 'auto';
            renderAll();
        };

        document.getElementById('reader-overlay').addEventListener('click', (e) => {
            if (e.target.id === 'reader-overlay') closeReader();
        });

        const loadRating = (news) => {
            const rating = news.rating || 0;
            document.querySelectorAll('#rating-stars .star').forEach((star, idx) => {
                star.classList.toggle('active', idx < rating);
                star.addEventListener('click', (e) => {
                    e.stopPropagation();
                    allNews[currentNewsIndex].rating = parseInt(star.dataset.rating);
                    saveNews();
                    loadRating(allNews[currentNewsIndex]);
                    showNotif(`‚≠ê ${star.dataset.rating}/5`);
                });
            });
        };

        const addNews = () => {
            const title = document.getElementById('news-title').value.trim();
            const category = document.getElementById('news-category').value.trim();

            if (!title || !category) {
                showNotif('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è *', 'error');
                return;
            }

            const news = {
                id: editingId || `news-${Date.now()}`,
                title,
                category,
                preview: document.getElementById('news-preview').value.trim() || title,
                content: document.getElementById('news-content').value.trim() || title,
                author: document.getElementById('news-author').value.trim() || 'TechFlow',
                image: document.getElementById('news-image').value.trim() || 'https://via.placeholder.com/300x200',
                date: editingId ? allNews.find(n => n.id === editingId).date : new Date().toISOString(),
                views: editingId ? allNews.find(n => n.id === editingId).views : 0,
                rating: editingId ? allNews.find(n => n.id === editingId).rating : 0
            };

            if (editingId) {
                const idx = allNews.findIndex(n => n.id === editingId);
                allNews[idx] = news;
                editingId = null;
            } else {
                allNews.unshift(news);
            }

            saveNews();
            clearForm();
            hideAdmin();
            renderAll();
            showNotif('‚úÖ ' + (editingId ? '–û–±–Ω–æ–≤–ª–µ–Ω–æ' : '–î–æ–±–∞–≤–ª–µ–Ω–æ'));
        };

        const editNews = (id) => {
            const news = allNews.find(n => n.id === id);
            if (!news) return;

            editingId = id;
            document.getElementById('news-title').value = news.title;
            document.getElementById('news-category').value = news.category;
            document.getElementById('news-preview').value = news.preview;
            document.getElementById('news-content').value = news.content;
            document.getElementById('news-author').value = news.author;
            document.getElementById('news-image').value = news.image;

            document.getElementById('add-news-btn').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            document.getElementById('cancel-btn').style.display = 'block';
            document.getElementById('admin-section').scrollIntoView({ behavior: 'smooth' });
            showAdmin();
        };

        const deleteNews = (id) => {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å?')) return;
            allNews = allNews.filter(n => n.id !== id);
            saveNews();
            renderAll();
            showNotif('‚ùå –£–¥–∞–ª–µ–Ω–æ');
        };

        const addCategory = () => {
            const newCat = document.getElementById('new-category').value.trim();
            if (!newCat) {
                showNotif('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error');
                return;
            }
            if (categories.includes(newCat)) {
                showNotif('‚ö†Ô∏è –¢–∞–∫–∞—è —É–∂–µ –µ—Å—Ç—å', 'error');
                return;
            }
            categories.push(newCat);
            saveCategories();
            document.getElementById('new-category').value = '';
            updateCategorySelect();
            updateCategoriesDisplay();
            showNotif('‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        };

        const deleteCategory = (cat) => {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å "${cat}"?`)) return;
            categories = categories.filter(c => c !== cat);
            saveCategories();
            updateCategorySelect();
            updateCategoriesDisplay();
            showNotif('‚ùå –£–¥–∞–ª–µ–Ω–æ');
        };

        const updateCategorySelect = () => {
            const select = document.getElementById('news-category');
            const opts = categories.map(c => `<option value="${c}">${c}</option>`).join('');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>' + opts;
        };

        const updateCategoriesDisplay = () => {
            const list = document.getElementById('categories-list');
            list.innerHTML = categories.map(c => `
                <span style="display: inline-block; background: var(--primary); color: white; padding: 6px 10px; border-radius: 3px; font-size: 12px; font-weight: 600; cursor: pointer;" onclick="deleteCategory('${c}')">
                    ${c} √ó
                </span>
            `).join('');
        };

        const clearForm = () => {
            document.getElementById('news-title').value = '';
            document.getElementById('news-category').value = '';
            document.getElementById('news-preview').value = '';
            document.getElementById('news-content').value = '';
            document.getElementById('news-author').value = '';
            document.getElementById('news-image').value = '';
            document.getElementById('add-news-btn').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å';
            document.getElementById('cancel-btn').style.display = 'none';
            editingId = null;
        };

        const showAdmin = () => {
            document.getElementById('admin-section').style.display = 'block';
        };

        const hideAdmin = () => {
            document.getElementById('admin-section').style.display = 'none';
            clearForm();
        };

        const toggleDark = () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('techflow_dark', document.body.classList.contains('dark-mode') ? '1' : '0');
            updateTheme();
        };

        const updateTheme = () => {
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        };

        const loadTheme = () => {
            if (localStorage.getItem('techflow_dark') === '1') {
                document.body.classList.add('dark-mode');
                updateTheme();
            }
        };

        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: '2-digit' });
        };

        const showNotif = (msg, type = 'success') => {
            const notif = document.createElement('div');
            notif.className = `notification ${type === 'error' ? 'error' : ''}`;
            notif.textContent = msg;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 2500);
        };

        const attachHandlers = () => {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                });
            });

            document.getElementById('admin-toggle').addEventListener('click', () => {
                if (document.getElementById('admin-section').style.display === 'none') {
                    showAdmin();
                } else {
                    hideAdmin();
                }
            });

            document.getElementById('theme-toggle').addEventListener('click', toggleDark);
            document.getElementById('add-news-btn').addEventListener('click', addNews);
            document.getElementById('cancel-btn').addEventListener('click', hideAdmin);
            document.getElementById('add-category-btn').addEventListener('click', addCategory);
            document.getElementById('new-category').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addCategory();
            });

            updateCategoriesDisplay();
        };

        window.addEventListener('storage', (e) => {
            if (e.key === 'techflow_news') {
                loadNews();
                renderAll();
            }
        });

        init();
    </script>
</body>
</html>
